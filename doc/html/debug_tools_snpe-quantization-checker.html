<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  Copyright (c) 2016-2018 Qualcomm Technologies, Inc.
  All Rights Reserved.
  Confidential and Proprietary - Qualcomm Technologies, Inc.
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-->
<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"></meta>
<meta http-equiv="X-UA-Compatible" content="IE=9"></meta>
<title>Snapdragon Neural Processing Engine SDK: Quantization Checker (Experimental)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"></link>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="autoEnterCurrentDate.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="is.css" rel="stylesheet" type="text/css" ></link>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Snapdragon Neural Processing Engine SDK
   <span id="projectnumber"></span></div>
   <div id="projectbrief">Reference Guide</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('debug_tools_snpe-quantization-checker.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Quantization Checker (Experimental) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <b>snpe-quantization-checker</b> tool is used to analyze the activations, weights and biases of all the possible quantization options available in the snpe-converters for each subsequent layer of a single model file or a directory of models. The analysis involves comparing the weight, bias and activation tensors of the quantized options to their unquantized counterparts. The tool runs the model to generate floating-point activations and analyzes floating-point weights, biases and activations to determine the quality of the encodings. It finally outputs the problematic weight, bias and activation tensors for all quantization options.</p>
<pre class="fragment">   usage: snpe-quantization-checker [--model MODEL_PATH]
                                   [--caffe_bin CAFFE_BIN]
                                   [--input_list INPUT_LIST_PATH]
                                   [--sdk_dir SDK_DIR_PATH] (Deprecated)
                                   [--activation_width ACT_BW]
                                   [--bias_width BIAS_BW]
                                   [--output_dir OUTPUT_DIR_PATH]
                                   [--skip_building_model]
                                   [--skip_generator] [--skip_runner]
                                   [--generate_histogram] [--per_channel_histogram]
                                   [--output_csv]
                                   --config_file CONFIG_FILE_PATH

   required arguments:
     --config_file - Path to the config file specifying all possible options required for execution.
                     E.g., [MODEL_PATH, CAFFE_BIN, INPUT_LIST_PATH, SDK_ROOT, ACTIVATION_WIDTH, BIAS_WIDTH, OUTPUT_DIR_PATH, ANDROID_NDK_PATH, CLANG_PATH, BASH_PATH, BIN_PATH, PY3_PATH, TENSORFLOW_HOME, CAFFE_HOME, ONNX_HOME, QUANTIZATION_OVERRIDES, WEIGHT_COMPARISON_ALGORITHMS, BIAS_COMPARISON_ALGORITHMS, ACT_COMPARISON_ALGORITHMS, INPUT_DATA_ANALYSIS_ALGORITHMS, OUTPUT_CSV]

   optional arguments:
     --model - Path to model graph file, it is required if MODEL_PATH is not set in the config_file.
     --caffe_bin - Path to caffe_bin .caffemodel file. It is required if the model is .prototxt and CAFFE_BIN is not present in the config_file.
     --input_list - Path to a text file containing a list of input files. It is required if the MODEL_PATH/model refers to a single model file and INPUT_LIST_PATH is not present in the config_file.
     --sdk_dir - Path to your unzipped snpe SDK, it is required if SDK_ROOT is not present in the config_file. This option will be deprecated in future releases.
     --activation_width - [Optional] Bit-width to use for activations. E.g., 8, 16. Default is 8. It can also be set using ACTIVATION_WIDTH field in the config_file.
     --bias_width - [Optional] Bit-width to use for biases. E.g., 8, 32. Default is 8. It can also be set using BIAS_WIDTH in the config_file.
     --output_dir - [Optional] Path to store the unquantized output files. It can also be set using OUTPUT_DIR_PATH in the config_file.
     --skip_building_model - [Optional] Stop the tool from building the model. It is assumed the model.so is pre-built.
     --skip_generator - [Optional] Stop the tool from running the snpe converter. It is assumed that the necessary files are already available.
     --skip_runner - [Optional] Stop the tool from running the model. It is assumed that the necessary files are already available.
     --generate_histogram - [Optional] Generate histogram analysis for weights/biases. Default is to skip histgoram generation.
     --per_channel_histogram - [Optional] Generate per channel histogram analysis for weights/biases. Default is to skip histgoram generation.
     --output_csv - [Optional] Store analysis results in csv files in the output directory.

    Please note: the arguments accepted on the command line will override those in the config file if there is overlap.</pre><p>Here is an example of different algorithms and thresholds mentioned in the config file:</p>
<pre class="fragment">   {
      // All other required user options can be added here

      "WEIGHT_COMPARISON_ALGORITHMS": [{"algo_name":"minmax", "threshold":"10"}, {"algo_name":"maxdiff", "threshold":"10"}, {"algo_name":"sqnr", "threshold":"26"}, {"algo_name":"stats", "threshold":"2"}, {"algo_name":"data_range_analyzer"}, {"algo_name":"data_distribution_analyzer", "threshold":"0.6"}],
      "BIAS_COMPARISON_ALGORITHMS": [{"algo_name":"minmax", "threshold":"10"}, {"algo_name":"maxdiff", "threshold":"10"}, {"algo_name":"sqnr", "threshold":"26"}, {"algo_name":"stats", "threshold":"2"}, {"algo_name":"data_range_analyzer"}, {"algo_name":"data_distribution_analyzer", "threshold":"0.6"}],
      "ACT_COMPARISON_ALGORITHMS": [{"algo_name":"minmax", "threshold":"10"}, {"algo_name":"data_range_analyzer"}]
   }</pre><p>The tool generates a <b>html</b> directory to include all .html files containing clear indicators of failures and successes for different combinations of quantization options and input files. The tool also produces a csv directory to include all .csv files storing detailed computation results for each metric. Additionally, the tool generates an output log file under the <b>snpe-quantization-checker-log</b> directory which contains all log outputs.</p>
<p><b> Viewing the results (html, csv or log files) </b><br />
</p>
<p>All results are stored in output directories under the user specified directory.</p>
<pre class="fragment">  # In user_specified_dir, all .html files are stored in "user_specified_dir/html", .csv files are stored in "user_specified_dir/csv" and log files are stored in "user_specified_dir/snpe-quantization-checker-log".
  cd ${Path_to_the_model}/user_specified_dir/html
  # This directory contains all the html files produced by the snpe-quantization-checker which can be opened with any standard web browser.
  cd ${Path_to_the_model}/user_specified_dir/csv
  # This directory contains all the csv files produced by the snpe-quantization-checker which can be viewed with any standard text editor or spreadsheet application such as Excel, LibreOffice, etc.
  cd ${Path_to_the_model}/user_specified_dir/snpe-quantization-checker-log
  # This directory contains all the log files produced by the snpe-quantization-checker. The files are time stamped and can be viewed in any text editor.</pre><p><b> HTML Results Files </b><br />
</p>
<p>Each HTML file contains a summary of the results for each quantization option and for each input file provided.<br />
</p>
<p><b>Note</b>: Snapshot of HTML content has been added for clarity.<br />
</p>
<p> <div style= text-align:left;><img src="images/snpe_quantization_checker_html_sample.png" alt="SNPE"><br/><br/><b></b></div><br/> </p>
<p><b> CSV Results Files </b><br />
</p>
<p>Each CSV file contains detailed computation results for a specific node type (activation/weight/bias) and quantization option. Each row in the csv file displays the op name, node name, passes accuracy (True/False), computation result (accuracy differences), threshold being used for each algorithm and the algorithm name. Computation results(accuracy differences) format can be somewhat different according to different algorithms/metrics.</p>
<p>The following are a few short notes about the different algorithms and the information each csv row contains:</p>
<p><b>minmax: Indicates the difference between the unquantized minimum and the dequantized minimum value. Correspondingly, indicates the same difference for the maximum unquantized and dequantized value.</b><br />
 Example computation result: "min: #VALUE max: #VALUE"<br />
 <b>maxdiff: Calculates the absolute difference between the unquantized and dequantized data for all data points and displays the maximum value of the result.</b><br />
 Example computation result: "#VALUE"<br />
 <b>sqnr: Calculates the signal to quantization noise ratio between the two tensors of unquantized and dequantized data.</b><br />
 Example computation result: "#VALUE"<br />
 <b>data_range_analyzer: Calculates the difference between the maximum and minimum values in a tensor and compares that to the maximum value supported by the bit-width used to determine if the range of values can be reasonably represented by the selected quantization bit width.</b><br />
 Example computation result: "unique dec places: #INT_VALUE data range : #VALUE". Information in the computation results field includes how many unique decimal places we need to express the unquantized data in quantized format and what is the actual data range.<br />
 <b>data_distribution_analyzer: Calculates the clustering of the data to find whether a large number of unique unquantized values are quantized to the same value or not.</b><br />
 Example computation result: "Distribution of pixels above threshold: #VALUE"<br />
 <b>stats: Calculates some basic statistics on the received data such as the min, max, median, variance, standard deviation, the mode and the skew. The skew is used to indicate how symmetric the data is.</b><br />
 Example computation result: skew: #VALUE min: #VALUE max: #VALUE median: #VALUE variance: #VALUE stdDev: #VALUE mode: #VALUE<br />
</p>
<p><b>Note</b>: Snapshot of a CSV file content for weight data for one of the quantization options has been added below.</p>
<p> <div style= text-align:left;><img src="images/snpe_quantization_checker_csv_weights.png" alt="SNPE"><br/><br/><b></b></div><br/> </p>
<p>Separate .csv files are available for activations, weights and biases for each quantization option. The activation related results also include analysis for each input file provided.</p>
<p><b> Log Result File </b><br />
</p>
<p>The log files contain the following information: </p><pre class="fragment">1. All the commands executed as part of the script’s run. This will include different runs of the snpe-converter tool with different quantization options
1. Activations Analysis Failures
2. Weights Analysis Failures
3. Biases Analysis Failures
</pre><p>A sample log output looks like below:</p>
<pre class="fragment">&lt;====ACTIVATIONS ANALYSIS FAILURES====&gt;

Results for the enhanced quantization:
|         Op Name         | Activation Node | Passes Accuracy |         Accuracy Difference          | Threshold Used | Algorithm Used |
|  conv_tanh_comp1_conv0  |    ReLU_6919    |      False      | minabs_diff: 0.59 maxabs_diff: 17.16 |      0.05      |     minmax     |

where,

1. Op Name : Op Name as expressed in snpe_model.cpp
2. Activation Node : Activation Node Name in the Op
3. Passes Accuracy : Pass if the quantized activation(or weight or bias) meets threshold when compared with values from float32 graph
4. Accuracy Difference : Details about the accuracy per the algorithm used
5. Threshold Used : The threshold used to influence the result of “Passes Accuracy” column
6. Algorithm Used : Metric used to compare actual quantized activations/weights/biases against unquantized float data or analyze the quality of unquantized float data. Metrics can be minmax, maxdiff, sqnr, stats, data_range_analyzer, data_distribution_analyzer.</pre> </div></div><!-- contents -->
</div><!-- doc-content -->
<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  Copyright (c) 2016-2018 Qualcomm Technologies, Inc.
  All Rights Reserved.
  Confidential and Proprietary - Qualcomm Technologies, Inc.
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 -->
<!-- start footer part -->
<div id="nav-path" class="navpath" font-size:small;><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <p align="right">
        80-NL315-14 A <br>
        MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
        <!--If the Controlled Distribution statement is to be included, uncomment below:-->
        <!--<b>Controlled Distribution - DO NOT COPY</b>-->
        <img class="footer" width:5%; alt="QTI Logo" src="images/QTI_Logo.png" />
      </p>
    </li>
  </ul>
</div>
</body>
</html>
