<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  Copyright (c) 2016-2018 Qualcomm Technologies, Inc.
  All Rights Reserved.
  Confidential and Proprietary - Qualcomm Technologies, Inc.
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-->
<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"></meta>
<meta http-equiv="X-UA-Compatible" content="IE=9"></meta>
<title>Snapdragon Neural Processing Engine SDK: C Tutorial - Build the Sample</title>
<link href="tabs.css" rel="stylesheet" type="text/css"></link>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="autoEnterCurrentDate.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="is.css" rel="stylesheet" type="text/css" ></link>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Snapdragon Neural Processing Engine SDK
   <span id="projectnumber"></span></div>
   <div id="projectbrief">Reference Guide</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('c_tutorial.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">C Tutorial - Build the Sample </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="tutorial_c_introduction"></a>
Introduction</h1>
<p>This tutorial demonstrates how to build a C sample application that can execute neural network models on the PC or target device.</p>
<p><b>Note:</b> While this sample code does not do any error checking, it is strongly recommended that users check for errors when using the SNPE APIs.</p>
<p>Most applications will follow the following pattern while using a neural network:</p>
<ol>
<li>
<a class="el" href="c_tutorial.html#c_tutorial_runtime_check">Get Available Runtime</a> </li>
<li>
<a class="el" href="c_tutorial.html#c_tutorial_load_container">Load Network</a> </li>
<li>
<a class="el" href="c_tutorial.html#c_tutorial_set_container_builder">Set Network Builder Options</a> </li>
<li>
<a class="el" href="c_tutorial.html#c_tutorial_load_network_inputs">Load Network Inputs</a> <ol>
<li>
<a class="el" href="c_tutorial.html#c_tutorial_load_input_itensors">Using ITensors</a> </li>
<li>
<a class="el" href="c_tutorial.html#c_tutorial_load_input_user_buffers">Using User Buffers</a> </li>
</ol>
</li>
<li>
<a class="el" href="c_tutorial.html#c_tutorial_execute">Execute the Network &amp; Process Output</a> <ol>
<li>
<a class="el" href="c_tutorial.html#c_tutorial_execute_itensors">Using ITensors</a> </li>
<li>
<a class="el" href="c_tutorial.html#c_tutorial_execute_user_buffers">Using User Buffers</a> </li>
</ol>
</li>
</ol>
<div class="fragment"><div class="line"><a class="code" href="group__c__apis.html#ga851ce6c63b2bd5515681a906330f7d01">Snpe_Runtime_t</a> runtime = checkRuntime();</div><div class="line"></div><div class="line"><a class="code" href="group__c__apis.html#ga8ac3074f1b064d0f22f271ad45e02fc0">Snpe_DlContainer_Handle_t</a> containerHandle = loadContainerFromFile(dlc);</div><div class="line"></div><div class="line"><a class="code" href="group__c__apis.html#gac4d946a1db4097746e726714e145e08a">Snpe_SNPE_Handle_t</a> snpeHandle = setBuilderOptions(containerHandle, runtime, useUserSuppliedBuffers);</div><div class="line"></div><div class="line"><a class="code" href="group__c__apis.html#ga34b8c6fc57325c0bde640c8b949b04b9">Snpe_TensorMap_Handle_t</a> inputTensorMapHandle = loadInputTensor(snpeHandle, fileLine); <span class="comment">// ITensor</span></div><div class="line">loadInputUserBuffer(applicationInputBuffers, snpeHandle, fileLine); <span class="comment">// User Buffer</span></div><div class="line"></div><div class="line">executeNetwork(snpeHandle , inputTensorMapHandle, OutputDir, inputListNum); <span class="comment">// ITensor</span></div><div class="line">executeNetwork(snpeHandle, inputMapHandle, outputMapHandle, applicationOutputBuffers, OutputDir, inputListNum); <span class="comment">// User Buffer</span></div></div><!-- fragment --><p>The sections below describe how to implement each step described above.</p>
<h1><a class="anchor" id="c_tutorial_runtime_check"></a>
Get Available Runtime</h1>
<p>The code excerpt below illustrates how to check if a specific runtime is available using the native APIs (the GPU runtime is used as an example).</p>
<div class="fragment"><div class="line"><a class="code" href="group__c__apis.html#ga851ce6c63b2bd5515681a906330f7d01">Snpe_Runtime_t</a> checkRuntime()</div><div class="line">{</div><div class="line">    <a class="code" href="group__c__apis.html#gab07d7501afd32b6713513727f7515078">Snpe_DlVersion_Handle_t</a> versionHandle = <a class="code" href="group__c__apis.html#ga5d6128c57418901420909b707117af46">Snpe_Util_GetLibraryVersion</a>();</div><div class="line">    <a class="code" href="group__c__apis.html#ga851ce6c63b2bd5515681a906330f7d01">Snpe_Runtime_t</a> Runtime;</div><div class="line"></div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;SNPE Version: &quot;</span> &lt;&lt; <a class="code" href="group__c__apis.html#gab7b8f37ca42dc390ce2dfa3ba904de4e">Snpe_DlVersion_ToString</a>(versionHandle) &lt;&lt; std::endl; <span class="comment">//Print Version number</span></div><div class="line">    <a class="code" href="group__c__apis.html#ga404dfb8c1e335781d222b02b6adcc1bc">Snpe_DlVersion_Delete</a>(versionHandle);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__c__apis.html#ga8a59fda854e6c1f27316b761edd689e5">Snpe_Util_IsRuntimeAvailable</a>(<a class="code" href="group__c__apis.html#gga851ce6c63b2bd5515681a906330f7d01af72874e807953ba3a96e9382c89cd90c">SNPE_RUNTIME_GPU</a>)) {</div><div class="line">        Runtime = <a class="code" href="group__c__apis.html#gga851ce6c63b2bd5515681a906330f7d01af72874e807953ba3a96e9382c89cd90c">SNPE_RUNTIME_GPU</a>;</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">        Runtime = <a class="code" href="group__c__apis.html#gga851ce6c63b2bd5515681a906330f7d01a97b4872eff44e8645c1edef533bf90c2">SNPE_RUNTIME_CPU</a>;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> Runtime;</div><div class="line">}</div></div><!-- fragment --> <h1><a class="anchor" id="c_tutorial_load_container"></a>
Load Network</h1>
<p>The code excerpt below illustrates how to load a network from the SNPE container file (DLC).</p>
<div class="fragment"><div class="line"><a class="code" href="group__c__apis.html#ga8ac3074f1b064d0f22f271ad45e02fc0">Snpe_DlContainer_Handle_t</a> loadContainerFromFile(std::string containerPath)</div><div class="line">{</div><div class="line">    <a class="code" href="group__c__apis.html#ga8ac3074f1b064d0f22f271ad45e02fc0">Snpe_DlContainer_Handle_t</a> containerHandle = <a class="code" href="group__c__apis.html#ga1108e8e4af71d7ffa75772820115dcf9">Snpe_DlContainer_Open</a>(containerPath.c_str());</div><div class="line">    <span class="keywordflow">return</span> containerHandle;</div><div class="line">}</div></div><!-- fragment --> <h1><a class="anchor" id="c_tutorial_set_container_builder"></a>
Set Network Builder Options</h1>
<p>The following code demonstrates how to instantiate a SNPE Builder object, which will be used to execute the network with the given parameters. </p><div class="fragment"><div class="line"><a class="code" href="group__c__apis.html#gac4d946a1db4097746e726714e145e08a">Snpe_SNPE_Handle_t</a> setBuilderOptions(<a class="code" href="group__c__apis.html#ga8ac3074f1b064d0f22f271ad45e02fc0">Snpe_DlContainer_Handle_t</a> containerHandle,</div><div class="line">                                                   Snpe_RuntimeListHandle_t runtimeListHandle,</div><div class="line">                                                   <span class="keywordtype">bool</span> useUserSuppliedBuffers)</div><div class="line">{</div><div class="line">    <a class="code" href="group__c__apis.html#gac4d946a1db4097746e726714e145e08a">Snpe_SNPE_Handle_t</a> snpeHandle;</div><div class="line">    <a class="code" href="group__c__apis.html#ga5525f7c887b922195624658ef8f12478">Snpe_SNPEBuilder_Handle_t</a> snpeBuilderHandle = <a class="code" href="group__c__apis.html#gabec895d2f45eb07b587b308c0c5c7cf3">Snpe_SNPEBuilder_Create</a>(containerHandle);</div><div class="line">    <a class="code" href="group__c__apis.html#ga46ea9a0da6b5905b2d6a88d600e5e24f">Snpe_SNPEBuilder_SetRuntimeProcessorOrder</a>(runtimeList)</div><div class="line">    <a class="code" href="group__c__apis.html#ga5fe239e9a439b8ab1ded0eb2e411ade6">Snpe_SNPEBuilder_SetUseUserSuppliedBuffers</a>(useUserSuppliedBuffers)</div><div class="line">    snpeHandle = <a class="code" href="group__c__apis.html#ga243656df3511bc730ac165b930e3a780">Snpe_SNPEBuilder_Build</a>(snpeBuilderHandle);</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> snpeHandle;</div><div class="line">}</div></div><!-- fragment --> <h1><a class="anchor" id="c_tutorial_load_network_inputs"></a>
Load Network Inputs</h1>
<p>Network inputs and outputs can be either user-backed buffers or ITensors (built-in SNPE buffers), but not both. The advantage of using user-backed buffers is that it eliminates an extra copy from user buffers to create ITensors. Both methods of loading network inputs are shown below.</p>
<h2><a class="anchor" id="c_tutorial_load_input_user_buffers"></a>
Using User Buffers</h2>
<p>SNPE can create its network inputs and outputs from user-backed buffers. Note that SNPE expects the values of the buffers to be present and valid during the duration of its execution.</p>
<p>Here is a function for creating a SNPE UserBuffer from a user-backed buffer and storing it in a UserBufferMap. These maps are a convenient collection of all input or output user buffers that can be passed to SNPE to execute the network.</p>
<p>Disclaimer: The strides of the buffer should already be known by the user and should not be calculated as shown below. The calculation shown is solely used for executing the example code.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> createUserBuffer(<a class="code" href="group__c__apis.html#ga2989cd43b0d4716b6c313ee6cbbd349e">Snpe_UserBufferMap_Handle_t</a> userBufferMapHandle,</div><div class="line">                      std::unordered_map&lt;std::string, std::vector&lt;uint8_t&gt;&gt;&amp; applicationBuffers,</div><div class="line">                      std::vector&lt;Snpe_IUserBuffer_Handle_t&gt; snpeUserBackedBuffersHandle,</div><div class="line">                      <a class="code" href="group__c__apis.html#gac4d946a1db4097746e726714e145e08a">Snpe_SNPE_Handle_t</a> snpeHandle,</div><div class="line">                      <span class="keyword">const</span> <span class="keywordtype">char</span> * name)</div><div class="line">{</div><div class="line">   <span class="comment">// get attributes of buffer by name</span></div><div class="line">   <a class="code" href="group__c__apis.html#ga5339ab1d422c3bf2213bbbd856b093de">Snpe_IBufferAttributes_Handle_t</a> bufferAttributesOptHandle = <a class="code" href="group__c__apis.html#gab83a768709354404ff6d97013b48253e">Snpe_SNPE_GetInputOutputBufferAttributes</a>(snpeHandle, name);</div><div class="line">   <span class="keywordflow">if</span> (bufferAttributesOptHandle == <span class="keyword">nullptr</span>) <span class="keywordflow">throw</span> std::runtime_error(std::string(<span class="stringliteral">&quot;Error obtaining attributes for input tensor &quot;</span>) + name);</div><div class="line"></div><div class="line">   <span class="comment">// calculate the size of buffer required by the input tensor</span></div><div class="line">   <a class="code" href="group__c__apis.html#gaa2c4ee3ae82899680c05757c4c44c1ee">Snpe_TensorShape_Handle_t</a> bufferShapeHandle = <a class="code" href="group__c__apis.html#ga9a2bd09838a81ab3c8b97873d8b1472e">Snpe_IBufferAttributes_GetDims</a>(bufferAttributesOptHandle);</div><div class="line"></div><div class="line">   <span class="comment">// Calculate the stride based on buffer strides, assuming tightly packed.</span></div><div class="line">   <span class="comment">// Note: Strides = Number of bytes to advance to the next element in each dimension.</span></div><div class="line">   <span class="comment">// For example, if a float tensor of dimension 2x4x3 is tightly packed in a buffer of 96 bytes, then the strides would be (48,12,4)</span></div><div class="line">   <span class="comment">// Note: Buffer stride is usually known and does not need to be calculated.</span></div><div class="line">   std::vector&lt;size_t&gt; strides(<a class="code" href="group__c__apis.html#gaa7e9a86ec9e42b5ef78e62e80596ac5e">Snpe_TensorShape_Rank</a>(bufferShapeHandle));</div><div class="line">   strides[strides.size() - 1] = <span class="keyword">sizeof</span>(float);</div><div class="line">   <span class="keywordtype">size_t</span> stride = strides[strides.size() - 1];</div><div class="line">   <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = <a class="code" href="group__c__apis.html#gaa7e9a86ec9e42b5ef78e62e80596ac5e">Snpe_TensorShape_Rank</a>(bufferShapeHandle) - 1; i &gt; 0; i--)</div><div class="line">   {</div><div class="line">      stride *= <a class="code" href="group__c__apis.html#gadd0bc813a6944ea9bf0edb95f7ebb590">Snpe_TensorShape_At</a>(bufferShapeHandle, i);</div><div class="line">      strides[i-1] = stride;</div><div class="line">   }</div><div class="line">   <a class="code" href="group__c__apis.html#gaa2c4ee3ae82899680c05757c4c44c1ee">Snpe_TensorShape_Handle_t</a> stridesHandle = <a class="code" href="group__c__apis.html#ga9795e5b62042261d0fb19bac43e6b191">Snpe_TensorShape_CreateDimsSize</a>(strides.data(), <a class="code" href="group__c__apis.html#gaa7e9a86ec9e42b5ef78e62e80596ac5e">Snpe_TensorShape_Rank</a>(bufferShapeHandle));</div><div class="line"></div><div class="line">   <span class="keywordtype">size_t</span> bufferElementSize = <a class="code" href="group__c__apis.html#ga2357d68f541395982d4f41d736333faf">Snpe_IBufferAttributes_GetElementSize</a>(bufferAttributesOptHandle);</div><div class="line">   <span class="keywordtype">size_t</span> bufSize = calcSizeFromDims(<a class="code" href="group__c__apis.html#gadfab44b53e35a57c920c495149230f24">Snpe_TensorShape_GetDimensions</a>(bufferShapeHandle), <a class="code" href="group__c__apis.html#gaa7e9a86ec9e42b5ef78e62e80596ac5e">Snpe_TensorShape_Rank</a>(bufferShapeHandle), bufferElementSize);</div><div class="line"></div><div class="line">   <span class="comment">// set the buffer encoding type</span></div><div class="line">   <a class="code" href="group__c__apis.html#gaf8d0448ead613b976948e31bc968f66b">Snpe_UserBufferEncoding_Handle_t</a> userBufferEncodingFloatHandle = <a class="code" href="group__c__apis.html#ga45eb9da0c7b281124c5909343c24ae9a">Snpe_UserBufferEncodingFloat_Create</a>();</div><div class="line"></div><div class="line">   <span class="comment">// create user-backed storage to load input data onto it</span></div><div class="line">   applicationBuffers.emplace(name, std::vector&lt;uint8_t&gt;(bufSize));</div><div class="line"></div><div class="line">   <span class="comment">// create SNPE user buffer from the user-backed buffer</span></div><div class="line">   ubsHandle.push_back(<a class="code" href="group__c__apis.html#gab09f89ba1573bcb8ed540dd14b846aff">Snpe_Util_CreateUserBuffer</a>(applicationBuffers.at(name).data(),</div><div class="line">                                                  bufSize,</div><div class="line">                                                  stridesHandle,</div><div class="line">                                                  userBufferEncodingFloatHandle));</div><div class="line"></div><div class="line">   <span class="comment">// add the user-backed buffer to the inputMap, which is later on fed to the network for execution</span></div><div class="line">   <a class="code" href="group__c__apis.html#gae0b60cbf32986d7947f549e63f87a4e6">Snpe_UserBufferMap_Add</a>(userBufferMapHandle, name, snpeUserBackedBuffersHandle.back());</div><div class="line">}</div></div><!-- fragment --> <p>The following function then shows how to load input data from file(s) to user buffers. Note that the input values are simply loaded onto user-backed buffers, on top of which SNPE can create SNPE UserBuffers, as shown above.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> loadInputUserBuffer(std::unordered_map&lt;std::string, std::vector&lt;uint8_t&gt;&gt;&amp; applicationBuffers,</div><div class="line">                               <a class="code" href="group__c__apis.html#gac4d946a1db4097746e726714e145e08a">Snpe_SNPE_Handle_t</a> snpeHandle,</div><div class="line">                               <span class="keyword">const</span> std::string&amp; fileLine)</div><div class="line">{</div><div class="line">    <span class="comment">// get input tensor names of the network that need to be populated</span></div><div class="line">    <a class="code" href="group__c__apis.html#ga86a9e0d044299b1ed6b8a85280830503">Snpe_StringList_Handle_t</a> inputNamesHandle = <a class="code" href="group__c__apis.html#ga9acad4dca8cebee4e8838102b22f542c">Snpe_SNPE_GetInputTensorNames</a>(snpeHandle);</div><div class="line">    <span class="keywordflow">if</span> (inputNamesHandle == <span class="keyword">nullptr</span>) <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Error obtaining input tensor names&quot;</span>);</div><div class="line">    assert(<a class="code" href="group__c__apis.html#ga4fdd18a5534fbf72a94f187d9a746bea">Snpe_StringList_Size</a>(inputNamesHandle) &gt; 0);</div><div class="line"></div><div class="line">    <span class="comment">// treat each line as a space-separated list of input files</span></div><div class="line">    std::vector&lt;std::string&gt; filePaths;</div><div class="line">    split(filePaths, fileLine, <span class="charliteral">&#39; &#39;</span>);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (<a class="code" href="group__c__apis.html#ga4fdd18a5534fbf72a94f187d9a746bea">Snpe_StringList_Size</a>(inputNamesHandle)) std::cout &lt;&lt; <span class="stringliteral">&quot;Processing DNN Input: &quot;</span> &lt;&lt; std::endl;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; <a class="code" href="group__c__apis.html#ga4fdd18a5534fbf72a94f187d9a746bea">Snpe_StringList_Size</a>(inputNamesHandle); i++) {</div><div class="line">        <span class="keyword">const</span> <span class="keywordtype">char</span>* name = <a class="code" href="group__c__apis.html#gadd13bd9b3d8e87d19f85a99f83c8437c">Snpe_StringList_At</a>(inputNamesHandle, i);</div><div class="line">        std::string filePath(filePaths[i]);</div><div class="line"></div><div class="line">        <span class="comment">// print out which file is being processed</span></div><div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; i + 1 &lt;&lt; <span class="stringliteral">&quot;) &quot;</span> &lt;&lt; filePath &lt;&lt; std::endl;</div><div class="line"></div><div class="line">        <span class="comment">// load file content onto application storage buffer,</span></div><div class="line">        <span class="comment">// on top of which, SNPE has created a user buffer</span></div><div class="line">        loadByteDataFile(filePath, applicationBuffers.at(name));</div><div class="line">    };</div><div class="line">}</div></div><!-- fragment --><h2><a class="anchor" id="c_tutorial_load_input_itensors"></a>
Using ITensors</h2>
<div class="fragment"><div class="line"><a class="code" href="group__c__apis.html#ga34b8c6fc57325c0bde640c8b949b04b9">Snpe_TensorMap_Handle_t</a> loadInputTensor (<a class="code" href="group__c__apis.html#gac4d946a1db4097746e726714e145e08a">Snpe_SNPE_Handle_t</a> snpeHandle, std::string&amp; fileLine)</div><div class="line">{</div><div class="line">    <a class="code" href="group__c__apis.html#gaac1985017a981e69e6a6efcf88f6ed34">Snpe_ITensor_Handle_t</a> input;</div><div class="line">    <a class="code" href="group__c__apis.html#ga86a9e0d044299b1ed6b8a85280830503">Snpe_StringList_Handle_t</a> strListHandle = <a class="code" href="group__c__apis.html#ga9acad4dca8cebee4e8838102b22f542c">Snpe_SNPE_GetInputTensorNames</a>(snpeHandle);</div><div class="line">    <span class="keywordflow">if</span> (strListHandle == <span class="keyword">nullptr</span>) <span class="keywordflow">throw</span> std::runtime_error(<span class="stringliteral">&quot;Error obtaining Input tensor names&quot;</span>);</div><div class="line">    <span class="comment">// Make sure the network requires only a single input</span></div><div class="line">    assert (<a class="code" href="group__c__apis.html#ga4fdd18a5534fbf72a94f187d9a746bea">Snpe_StringList_Size</a>(strListHandle) == 1);</div><div class="line">    <span class="comment">// If the network has a single input, each line represents the input file to be loaded for that input</span></div><div class="line"></div><div class="line">    std::string filePath(fileLine);</div><div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Processing DNN Input: &quot;</span> &lt;&lt; filePath &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">    std::vector&lt;float&gt; inputVec = loadFloatDataFile(filePath);</div><div class="line"></div><div class="line">    <span class="comment">/* Create an input tensor that is correctly sized to hold the input of the network. Dimensions that have no fixed size will be represented with a value of 0. */</span></div><div class="line"></div><div class="line">    <span class="keyword">auto</span> inputDimsHandle = <a class="code" href="group__c__apis.html#ga0482d473bd5527053a4c264e773b4deb">Snpe_SNPE_GetInputDimensions</a>(snpeHandle, <a class="code" href="group__c__apis.html#gadd13bd9b3d8e87d19f85a99f83c8437c">Snpe_StringList_At</a>(strListHandle, 0));</div><div class="line"></div><div class="line">    <span class="comment">/* Calculate the total number of elements that can be stored in the tensor so that we can check that the input contains the expected number of elements.</span></div><div class="line"><span class="comment"></span></div><div class="line"><span class="comment">       With the input dimensions computed create a tensor to convey the input into the network. */</span></div><div class="line">    input = <a class="code" href="group__c__apis.html#ga40e9a46cb2b3289844fce8bbf95f02b4">Snpe_Util_CreateITensor</a>(inputDimsHandle);</div><div class="line"></div><div class="line">    <span class="comment">/* Copy the loaded input file contents into the networks input tensor.SNPE&#39;s ITensor supports C++ STL functions like std::copy() */</span></div><div class="line"></div><div class="line">    std::copy(inputVec.begin(), inputVec.end(), (<span class="keywordtype">float</span>*)<a class="code" href="group__c__apis.html#ga3bb2b44341e329e2c984dc0febbc9127">Snpe_ITensor_GetData</a>(input));</div><div class="line">    <a class="code" href="group__c__apis.html#ga34b8c6fc57325c0bde640c8b949b04b9">Snpe_TensorMap_Handle_t</a> inputTensorMapHandle = <a class="code" href="group__c__apis.html#ga800adba401ebfafcadc00ebe3b1e294a">Snpe_TensorMap_Create</a>();</div><div class="line">    <a class="code" href="group__c__apis.html#ga749cf32071ec38c55af70a896eae77e6">Snpe_TensorMap_Add</a>(inputTensorMapHandle, <a class="code" href="group__c__apis.html#gadd13bd9b3d8e87d19f85a99f83c8437c">Snpe_StringList_At</a>(strListHandle, 0), inputs[i]);</div><div class="line">    <span class="keywordflow">return</span> inputTensorMapHandle;</div><div class="line">}</div></div><!-- fragment -->  <h1><a class="anchor" id="c_tutorial_execute"></a>
Execute the Network &amp; Process Output</h1>
<p>The following snippets of code use the native API to execute the network (in UserBuffer or ITensor mode) and show how to iterate through the newly populated output tensor.</p>
<h2><a class="anchor" id="c_tutorial_execute_user_buffers"></a>
Using User Buffers</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> executeNetwork(<a class="code" href="group__c__apis.html#gac4d946a1db4097746e726714e145e08a">Snpe_SNPE_Handle_t</a> snpeHandle,</div><div class="line">                    <a class="code" href="group__c__apis.html#ga2989cd43b0d4716b6c313ee6cbbd349e">Snpe_UserBufferMap_Handle_t</a> inputMapHandle,</div><div class="line">                    <a class="code" href="group__c__apis.html#ga2989cd43b0d4716b6c313ee6cbbd349e">Snpe_UserBufferMap_Handle_t</a> outputMapHandle,</div><div class="line">                    std::unordered_map&lt;std::string,std::vector&lt;uint8_t&gt;&gt;&amp; applicationOutputBuffers,</div><div class="line">                    <span class="keyword">const</span> std::string&amp; outputDir,</div><div class="line">                    <span class="keywordtype">int</span> num)</div><div class="line">{</div><div class="line">    <span class="comment">// Execute the network and store the outputs in user buffers specified in outputMap</span></div><div class="line">    <a class="code" href="group__c__apis.html#gaf84455adab19f6b205bf1beabed74df4">Snpe_SNPE_ExecuteUserBuffers</a>(snpeHandle, inputMapHandle, outputMapHandle);</div><div class="line"></div><div class="line">    <span class="comment">// Get all output buffer names from the network</span></div><div class="line">    <a class="code" href="group__c__apis.html#ga86a9e0d044299b1ed6b8a85280830503">Snpe_StringList_Handle_t</a> outputBufferNamesHandle = <a class="code" href="group__c__apis.html#ga6602910d94b918aa2c05385d454a79e8">Snpe_UserBufferMap_GetUserBufferNames</a>(outputMapHandle);</div><div class="line"></div><div class="line">    <span class="comment">// Iterate through output buffers and print each output to a raw file</span></div><div class="line">    std::for_each(<a class="code" href="group__c__apis.html#gaaf27c982f0db81b9fa623c16a3bdac27">Snpe_StringList_Begin</a>(outputBufferNamesHandle), <a class="code" href="group__c__apis.html#ga7a3fbfe10367219849f6dbe2c0833edd">Snpe_StringList_End</a>(outputBufferNamesHandle), [&amp;](<span class="keyword">const</span> <span class="keywordtype">char</span>* name)</div><div class="line">    {</div><div class="line">       std::ostringstream path;</div><div class="line">       path &lt;&lt; outputDir &lt;&lt; <span class="stringliteral">&quot;/Result_&quot;</span> &lt;&lt; num &lt;&lt; <span class="stringliteral">&quot;/&quot;</span> &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;.raw&quot;</span>;</div><div class="line"></div><div class="line">       SaveUserBuffer(path.str(), applicationOutputBuffers.at(name));</div><div class="line">    });</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// The following is a partial snippet of the function</span></div><div class="line"><span class="keywordtype">void</span> SaveUserBuffer(<span class="keyword">const</span> std::string&amp; path, <span class="keyword">const</span> std::vector&lt;uint8_t&gt;&amp; buffer) {</div><div class="line">   ...</div><div class="line">   std::ofstream os(path, std::ofstream::binary);</div><div class="line">   <span class="keywordflow">if</span> (!os)</div><div class="line">   {</div><div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to open output file for writing: &quot;</span> &lt;&lt; path &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">      std::exit(EXIT_FAILURE);</div><div class="line">   }</div><div class="line"></div><div class="line">   <span class="keywordflow">if</span> (!os.write((<span class="keywordtype">char</span>*)(buffer.data()), buffer.size()))</div><div class="line">   {</div><div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to write data to: &quot;</span> &lt;&lt; path &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">      std::exit(EXIT_FAILURE);</div><div class="line">   }</div><div class="line">}</div></div><!-- fragment --> <h2><a class="anchor" id="c_tutorial_execute_itensors"></a>
Using ITensors</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> executeNetwork(<a class="code" href="group__c__apis.html#gac4d946a1db4097746e726714e145e08a">Snpe_SNPE_Handle_t</a> snpeHandle,</div><div class="line">                    <a class="code" href="group__c__apis.html#ga34b8c6fc57325c0bde640c8b949b04b9">Snpe_TensorMap_Handle_t</a> inputTensorMapHandle,</div><div class="line">                    std::string OutputDir,</div><div class="line">                    <span class="keywordtype">int</span> num)</div><div class="line">{</div><div class="line">    <span class="comment">// Execute the network and store the outputs that were specified when creating the network in a TensorMap</span></div><div class="line">    <a class="code" href="group__c__apis.html#ga34b8c6fc57325c0bde640c8b949b04b9">Snpe_TensorMap_Handle_t</a> outputTensorMapHandle = <a class="code" href="group__c__apis.html#ga800adba401ebfafcadc00ebe3b1e294a">Snpe_TensorMap_Create</a>();</div><div class="line">    <a class="code" href="group__c__apis.html#ga02e47f9c60c2f5fdc734015199bf4591">Snpe_SNPE_ExecuteITensors</a>(snpeHandle, inputTensorMapHandle, outputTensorMapHandle);</div><div class="line">    <a class="code" href="group__c__apis.html#ga86a9e0d044299b1ed6b8a85280830503">Snpe_StringList_Handle_t</a> tensorNamesHandle = <a class="code" href="group__c__apis.html#gac70c08ba305074da1818a5c5173c26f0">Snpe_TensorMap_GetTensorNames</a>(outputTensorMapHandle);</div><div class="line"></div><div class="line">    <span class="comment">// Iterate through the output Tensor map, and print each output layer name</span></div><div class="line">    std::for_each( <a class="code" href="group__c__apis.html#gaaf27c982f0db81b9fa623c16a3bdac27">Snpe_StringList_Begin</a>(tensorNamesHandle), <a class="code" href="group__c__apis.html#ga7a3fbfe10367219849f6dbe2c0833edd">Snpe_StringList_End</a>(tensorNamesHandle), [&amp;](<span class="keyword">const</span> <span class="keywordtype">char</span>* name)</div><div class="line">    {</div><div class="line">        std::ostringstream path;</div><div class="line">        path &lt;&lt; OutputDir &lt;&lt; <span class="stringliteral">&quot;/&quot;</span></div><div class="line">        &lt;&lt; <span class="stringliteral">&quot;Result_&quot;</span> &lt;&lt; num &lt;&lt; <span class="stringliteral">&quot;/&quot;</span></div><div class="line">        &lt;&lt; name &lt;&lt; <span class="stringliteral">&quot;.raw&quot;</span>;</div><div class="line">        <span class="keyword">auto</span> tensorHandle = <a class="code" href="group__c__apis.html#gafcb401c4316754a86d0e64610b44dd0f">Snpe_TensorMap_GetTensor_Ref</a>(outputTensorMapHandle, name);</div><div class="line">        SaveITensor(path.str(), tensorHandle);</div><div class="line">    });</div><div class="line"></div><div class="line">    <span class="comment">// Clean up created handles</span></div><div class="line">    <a class="code" href="group__c__apis.html#gac084b377e28651e2f546f3bd17fed478">Snpe_TensorMap_Delete</a>(outputTensorMapHandle);</div><div class="line">    <a class="code" href="group__c__apis.html#ga88b38a24a1d114b1a6e12b076ecf7a82">Snpe_StringList_Delete</a>(tensorNamesHandle);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// The following is a partial snippet of the function</span></div><div class="line"><span class="keywordtype">void</span> SaveITensor(<span class="keyword">const</span> std::string&amp; path, <a class="code" href="group__c__apis.html#gaac1985017a981e69e6a6efcf88f6ed34">Snpe_ITensor_Handle_t</a> tensorHandle)</div><div class="line">{</div><div class="line">   ...</div><div class="line"></div><div class="line">   std::ofstream os(path, std::ofstream::binary);</div><div class="line">   <span class="keywordflow">if</span> (!os)</div><div class="line">   {</div><div class="line">      std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to open output file for writing: &quot;</span> &lt;&lt; path &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">      std::exit(EXIT_FAILURE);</div><div class="line">   }</div><div class="line">   <span class="keyword">auto</span> begin = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span>*<span class="keyword">&gt;</span>(<a class="code" href="group__c__apis.html#ga3bb2b44341e329e2c984dc0febbc9127">Snpe_ITensor_GetData</a>(tensorHandle));</div><div class="line">   <span class="keyword">auto</span> size = <a class="code" href="group__c__apis.html#gad5ca11ffac34766679e5d3bbb4d89bc3">Snpe_ITensor_GetSize</a>(tensorHandle);</div><div class="line">   <span class="keywordflow">for</span> ( <span class="keyword">auto</span> it = begin; it != begin + size; ++it )</div><div class="line">   {</div><div class="line">      <span class="keywordtype">float</span> f = *it;</div><div class="line">      <span class="keywordflow">if</span> (!os.write(reinterpret_cast&lt;char*&gt;(&amp;f), <span class="keyword">sizeof</span>(<span class="keywordtype">float</span>)))</div><div class="line">      {</div><div class="line">         std::cerr &lt;&lt; <span class="stringliteral">&quot;Failed to write data to: &quot;</span> &lt;&lt; path &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;</div><div class="line">         std::exit(EXIT_FAILURE);</div><div class="line">      }</div><div class="line">   }</div><div class="line">}</div></div><!-- fragment -->   </div></div><!-- contents -->
</div><!-- doc-content -->
<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  Copyright (c) 2016-2018 Qualcomm Technologies, Inc.
  All Rights Reserved.
  Confidential and Proprietary - Qualcomm Technologies, Inc.
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
 -->
<!-- start footer part -->
<div id="nav-path" class="navpath" font-size:small;><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">
      <p align="right">
        80-NL315-14 A <br>
        MAY CONTAIN U.S. AND INTERNATIONAL EXPORT CONTROLLED INFORMATION
        <!--If the Controlled Distribution statement is to be included, uncomment below:-->
        <!--<b>Controlled Distribution - DO NOT COPY</b>-->
        <img class="footer" width:5%; alt="QTI Logo" src="images/QTI_Logo.png" />
      </p>
    </li>
  </ul>
</div>
</body>
</html>
